# 15 - 测试策略（系统项目可落地）

本章目标：建立 Rust 测试分层心智，而不是只会写 `assert_eq!`。

## 1. 测试分层

| 层级 | 关注点 | 典型位置 |
| --- | --- | --- |
| 单元测试 | 小函数/模块行为 | `src/*` 内 `#[cfg(test)]` |
| 集成测试 | crate 对外行为 | `tests/*.rs` |
| 属性测试 | 输入空间不变量 | `proptest`/`quickcheck` |
| Fuzz 测试 | 发现崩溃与边界缺陷 | `cargo-fuzz` |

## 2. 系统程序常见测试关注

- 边界值：长度 0、最大值、非法输入。
- 并发行为：竞态窗口、超时、取消。
- 二进制协议：端序、对齐、截断数据。
- FFI：ABI 兼容、错误码一致性。

## 3. 实战建议

- 先写可读单测，再补集成测试。
- 对解析器/协议优先做属性测试。
- 把历史线上 bug 固化成回归测试。
- CI 至少包含 `cargo test` + `cargo clippy`。

## 4. 一句话总结

- 测试不是“补作业”，而是系统工程里的稳定性资产。
