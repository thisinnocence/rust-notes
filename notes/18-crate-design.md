# 18 - Crate 设计与 API 稳定性

本章目标：从“能写库”走向“能维护多年”的库。

## 1. API 设计核心

- 默认最小公开面：少 `pub`。
- 先设计类型语义，再设计函数数量。
- 把不变量放进类型，而不是文档备注。

## 2. feature flag 策略

- 用 feature 控制可选依赖和扩展能力。
- 避免 feature 组合爆炸（保持正交、可预测）。
- 明确默认 feature 的稳定承诺。

## 3. 版本策略（SemVer）

- `MAJOR`：破坏性改动。
- `MINOR`：向后兼容新增。
- `PATCH`：兼容修复。

## 4. 实战建议

- 为公开 API 写文档和示例。
- 在 CI 增加 `cargo semver-checks`（如可用）。
- 把“迁移指南”作为版本发布的一部分。

## 5. 一句话总结

- crate 设计的本质是“稳定演进”，不是“一次性完美抽象”。
