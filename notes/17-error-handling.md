# 17 - 错误处理工程化（库层与应用层分工）

本章目标：把错误处理从“能打印”升级成“可维护的系统协议”。

## 1. 分层策略

| 层 | 建议 |
| --- | --- |
| 库层 | 精确错误类型（`thiserror` 思路） |
| 应用层 | 聚合上下文（`anyhow` 思路） |

## 2. 为什么要分层

- 库层需要稳定、可匹配的错误语义。
- 应用层更关注可观测性和上下文信息。

## 3. 设计准则

- 错误类型表达“可行动信息”。
- 在边界处补充上下文（文件名、参数、阶段）。
- 避免吞错；保留根因链。

## 4. 对系统程序员的价值

- 降低故障定位时间。
- 让重试/降级/告警策略更可编程。
- 让跨模块协作时错误语义稳定。

## 5. 小结

- 好的错误处理不是“日志更长”，而是“语义更清楚，动作更明确”。
